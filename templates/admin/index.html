{% extends 'admin/base.html' %}
{% load i18n %}
{% load static %}

{% block title %}
    {% if subtitle %}
        {{ subtitle }} |
    {% endif %}
    {{ title }} | {{ site_title|default:_('Django site admin') }}
{% endblock %}

{% block branding %}
    {% include "unfold/helpers/site_branding.html" %}
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gradient-to-br from-slate-50 via-gray-50 to-slate-100 dark:from-gray-950 dark:via-gray-900 dark:to-slate-900 transition-colors duration-500">

  <div class="max-w-[1600px] mx-auto px-4 sm:px-6 lg:px-8 py-8">

    <!-- Page Header -->
    <div class="mb-10">
      <h1 class="text-4xl font-extrabold text-gray-900 dark:text-white tracking-tight mb-2">
        Dashboard
      </h1>
      <p class="text-base text-gray-600 dark:text-gray-400 font-medium">
        Overview of your platform's key metrics and insights
      </p>
    </div>

    <!-- Statistics Cards Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-5 mb-10">

      <!-- Card 1: Users -->
      <div class="group relative overflow-hidden rounded-2xl bg-gradient-to-br from-blue-50 to-cyan-50 dark:!bg-gray-900 border border-blue-100 dark:border-blue-800/60 shadow-sm hover:shadow-xl dark:shadow-blue-900/20 dark:hover:shadow-blue-800/40 transition-all duration-300 hover:-translate-y-1 cursor-default backdrop-blur-sm">
        <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/5 dark:bg-blue-400/10 rounded-full -mr-16 -mt-16 transition-transform duration-500 group-hover:scale-150"></div>
        <div class="relative p-6">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-blue-500 to-cyan-600 dark:from-blue-600 dark:to-cyan-700 shadow-lg shadow-blue-500/30 dark:shadow-blue-500/30 group-hover:shadow-blue-500/50 dark:group-hover:shadow-blue-500/60 transition-shadow duration-300">
              <svg class="w-6 h-6 text-white dark:text-gray-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
            </div>
            <span class="flex items-center text-xs font-semibold text-blue-600 dark:text-blue-300 bg-blue-100 dark:bg-blue-900/70 px-2.5 py-1 rounded-full border border-blue-200/50 dark:border-blue-700/50">
              <svg class="w-3 h-3 mr-1 text-blue-600 dark:text-blue-300" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
              +12%
            </span>
          </div>
          <div class="space-y-1">
            <p class="text-sm font-semibold text-blue-700 dark:text-blue-300 uppercase tracking-wide">
              Foydalanuvchilar
            </p>
            <p class="text-3xl font-black text-gray-900 dark:text-white tracking-tight">
              {{ stats.total_users }}
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-300 font-medium">
              Total registered users
            </p>
          </div>
        </div>
      </div>

      <!-- Card 2: Premium Users -->
      <div class="group relative overflow-hidden rounded-2xl bg-gradient-to-br from-violet-50 to-fuchsia-50 dark:!bg-gray-900 border border-violet-100 dark:border-violet-800/60 shadow-sm hover:shadow-xl dark:shadow-violet-900/20 dark:hover:shadow-violet-800/40 transition-all duration-300 hover:-translate-y-1 cursor-default backdrop-blur-sm">
        <div class="absolute top-0 right-0 w-32 h-32 bg-violet-500/5 dark:bg-violet-400/10 rounded-full -mr-16 -mt-16 transition-transform duration-500 group-hover:scale-150"></div>
        <div class="relative p-6">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-violet-500 to-fuchsia-600 dark:from-violet-600 dark:to-fuchsia-700 shadow-lg shadow-violet-500/30 dark:shadow-violet-500/30 group-hover:shadow-violet-500/50 dark:group-hover:shadow-violet-500/60 transition-shadow duration-300">
              <svg class="w-6 h-6 text-white dark:text-gray-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
              </svg>
            </div>
            <span class="flex items-center text-xs font-semibold text-violet-600 dark:text-violet-300 bg-violet-100 dark:bg-violet-900/70 px-2.5 py-1 rounded-full border border-violet-200/50 dark:border-violet-700/50">
              <svg class="w-3 h-3 mr-1 text-violet-600 dark:text-violet-300" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
              +8%
            </span>
          </div>
          <div class="space-y-1">
            <p class="text-sm font-semibold text-violet-700 dark:text-violet-300 uppercase tracking-wide">
              Premium
            </p>
            <p class="text-3xl font-black text-gray-900 dark:text-white tracking-tight">
              {{ stats.premium_users }}
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-300 font-medium">
              Premium subscribers
            </p>
          </div>
        </div>
      </div>

      <!-- Card 3: Active Users -->
      <div class="group relative overflow-hidden rounded-2xl bg-gradient-to-br from-emerald-50 to-teal-50 dark:!bg-gray-900 border border-emerald-100 dark:border-emerald-800/60 shadow-sm hover:shadow-xl dark:shadow-emerald-900/20 dark:hover:shadow-emerald-800/40 transition-all duration-300 hover:-translate-y-1 cursor-default backdrop-blur-sm">
        <div class="absolute top-0 right-0 w-32 h-32 bg-emerald-500/5 dark:bg-emerald-400/10 rounded-full -mr-16 -mt-16 transition-transform duration-500 group-hover:scale-150"></div>
        <div class="relative p-6">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 dark:from-emerald-600 dark:to-teal-700 shadow-lg shadow-emerald-500/30 dark:shadow-emerald-500/30 group-hover:shadow-emerald-500/50 dark:group-hover:shadow-emerald-500/60 transition-shadow duration-300">
              <svg class="w-6 h-6 text-white dark:text-gray-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <span class="flex items-center text-xs font-semibold text-emerald-600 dark:text-emerald-300 bg-emerald-100 dark:bg-emerald-900/70 px-2.5 py-1 rounded-full border border-emerald-200/50 dark:border-emerald-700/50">
              <svg class="w-3 h-3 mr-1 text-emerald-600 dark:text-emerald-300" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
              +15%
            </span>
          </div>
          <div class="space-y-1">
            <p class="text-sm font-semibold text-emerald-700 dark:text-emerald-300 uppercase tracking-wide">
              Aktiv
            </p>
            <p class="text-3xl font-black text-gray-900 dark:text-white tracking-tight">
              {{ stats.active_users }}
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-300 font-medium">
              Currently active users
            </p>
          </div>
        </div>
      </div>

      <!-- Card 4: Movies -->
      <div class="group relative overflow-hidden rounded-2xl bg-gradient-to-br from-amber-50 to-orange-50 dark:!bg-gray-900 border border-amber-100 dark:border-amber-800/60 shadow-sm hover:shadow-xl dark:shadow-amber-900/20 dark:hover:shadow-amber-800/40 transition-all duration-300 hover:-translate-y-1 cursor-default backdrop-blur-sm">
        <div class="absolute top-0 right-0 w-32 h-32 bg-amber-500/5 dark:bg-amber-400/10 rounded-full -mr-16 -mt-16 transition-transform duration-500 group-hover:scale-150"></div>
        <div class="relative p-6">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 dark:from-amber-600 dark:to-orange-700 shadow-lg shadow-amber-500/30 dark:shadow-amber-500/30 group-hover:shadow-amber-500/50 dark:group-hover:shadow-amber-500/60 transition-shadow duration-300">
              <svg class="w-6 h-6 text-white dark:text-gray-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4a1 1 0 00-1 1v14a1 1 0 001 1z" />
              </svg>
            </div>
            <span class="flex items-center text-xs font-semibold text-amber-600 dark:text-amber-300 bg-amber-100 dark:bg-amber-900/70 px-2.5 py-1 rounded-full border border-amber-200/50 dark:border-amber-700/50">
              <svg class="w-3 h-3 mr-1 text-amber-600 dark:text-amber-300" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
              +5%
            </span>
          </div>
          <div class="space-y-1">
            <p class="text-sm font-semibold text-amber-700 dark:text-amber-300 uppercase tracking-wide">
              Kinolar
            </p>
            <p class="text-3xl font-black text-gray-900 dark:text-white tracking-tight">
              {{ stats.total_movies }}
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-300 font-medium">
              Total movie catalog
            </p>
          </div>
        </div>
      </div>

      <!-- Card 5: Reviews -->
      <div class="group relative overflow-hidden rounded-2xl bg-gradient-to-br from-rose-50 to-pink-50 dark:!bg-gray-900 border border-rose-100 dark:border-rose-800/60 shadow-sm hover:shadow-xl dark:shadow-rose-900/20 dark:hover:shadow-rose-800/40 transition-all duration-300 hover:-translate-y-1 cursor-default backdrop-blur-sm">
        <div class="absolute top-0 right-0 w-32 h-32 bg-rose-500/5 dark:bg-rose-400/10 rounded-full -mr-16 -mt-16 transition-transform duration-500 group-hover:scale-150"></div>
        <div class="relative p-6">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-rose-500 to-pink-600 dark:from-rose-600 dark:to-pink-700 shadow-lg shadow-rose-500/30 dark:shadow-rose-500/30 group-hover:shadow-rose-500/50 dark:group-hover:shadow-rose-500/60 transition-shadow duration-300">
              <svg class="w-6 h-6 text-white dark:text-gray-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z" />
              </svg>
            </div>
            <span class="flex items-center text-xs font-semibold text-rose-600 dark:text-rose-300 bg-rose-100 dark:bg-rose-900/70 px-2.5 py-1 rounded-full border border-rose-200/50 dark:border-rose-700/50">
              <svg class="w-3 h-3 mr-1 text-rose-600 dark:text-rose-300" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
              +22%
            </span>
          </div>
          <div class="space-y-1">
            <p class="text-sm font-semibold text-rose-700 dark:text-rose-300 uppercase tracking-wide">
              Sharhlar
            </p>
            <p class="text-3xl font-black text-gray-900 dark:text-white tracking-tight">
              {{ stats.total_reviews }}
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-300 font-medium">
              User reviews posted
            </p>
          </div>
        </div>
      </div>

      <!-- Card 6: Bookmarks -->
      <div class="group relative overflow-hidden rounded-2xl bg-gradient-to-br from-sky-50 to-blue-50 dark:!bg-gray-900 border border-sky-100 dark:border-sky-800/60 shadow-sm hover:shadow-xl dark:shadow-sky-900/20 dark:hover:shadow-sky-800/40 transition-all duration-300 hover:-translate-y-1 cursor-default backdrop-blur-sm">
        <div class="absolute top-0 right-0 w-32 h-32 bg-sky-500/5 dark:bg-sky-400/10 rounded-full -mr-16 -mt-16 transition-transform duration-500 group-hover:scale-150"></div>
        <div class="relative p-6">
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center justify-center w-12 h-12 rounded-xl bg-gradient-to-br from-sky-500 to-blue-600 dark:from-sky-600 dark:to-blue-700 shadow-lg shadow-sky-500/30 dark:shadow-sky-500/30 group-hover:shadow-sky-500/50 dark:group-hover:shadow-sky-500/60 transition-shadow duration-300">
              <svg class="w-6 h-6 text-white dark:text-gray-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M5 5a2 2 0 012-2h10a2 2 0 012 2v16l-7-3.5L5 21V5z" />
              </svg>
            </div>
            <span class="flex items-center text-xs font-semibold text-sky-600 dark:text-sky-300 bg-sky-100 dark:bg-sky-900/70 px-2.5 py-1 rounded-full border border-sky-200/50 dark:border-sky-700/50">
              <svg class="w-3 h-3 mr-1 text-sky-600 dark:text-sky-300" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M5.293 9.707a1 1 0 010-1.414l4-4a1 1 0 011.414 0l4 4a1 1 0 01-1.414 1.414L11 7.414V15a1 1 0 11-2 0V7.414L6.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
              </svg>
              +18%
            </span>
          </div>
          <div class="space-y-1">
            <p class="text-sm font-semibold text-sky-700 dark:text-sky-300 uppercase tracking-wide">
              Bookmarks
            </p>
            <p class="text-3xl font-black text-gray-900 dark:text-white tracking-tight">
              {{ stats.total_bookmarks }}
            </p>
            <p class="text-xs text-gray-600 dark:text-gray-300 font-medium">
              Saved by users
            </p>
          </div>
        </div>
      </div>

    </div>

    <!-- Charts Section -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-10">

      <!-- Users Distribution Chart -->
      <div class="group relative overflow-hidden rounded-2xl bg-white dark:!bg-gray-900 backdrop-blur-sm border border-gray-200 dark:border-gray-700/80 shadow-lg hover:shadow-2xl dark:shadow-gray-900/30 dark:hover:shadow-gray-900/50 transition-all duration-300">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-violet-500 via-fuchsia-500 to-violet-500 opacity-75 dark:opacity-90"></div>
        <div class="p-6 border-b border-gray-100 dark:border-gray-700/60 bg-gradient-to-br from-gray-50/50 to-transparent dark:from-gray-800/30">
          <div class="flex items-center space-x-3">
            <div class="flex items-center justify-center w-11 h-11 rounded-xl bg-gradient-to-br from-violet-500 to-fuchsia-600 shadow-lg shadow-violet-500/30">
              <svg class="w-6 h-6 text-white dark:text-gray-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z" />
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z" />
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight">
                Foydalanuvchilar taqsimoti
              </h2>
              <p class="text-sm text-gray-600 dark:text-gray-300 font-medium mt-0.5">
                Premium vs Regular distribution
              </p>
            </div>
          </div>
        </div>
        <div class="p-8 bg-white dark:!bg-gray-900">
          <div class="flex items-center justify-center" style="height: 300px;">
            <canvas id="usersPieChart"></canvas>
          </div>
        </div>
      </div>

      <!-- User Activity Chart -->
      <div class="group relative overflow-hidden rounded-2xl bg-white dark:!bg-gray-900 backdrop-blur-sm border border-gray-200 dark:border-gray-700/80 shadow-lg hover:shadow-2xl dark:shadow-gray-900/30 dark:hover:shadow-gray-900/50 transition-all duration-300">
        <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-emerald-500 via-teal-500 to-emerald-500 opacity-75 dark:opacity-90"></div>
        <div class="p-6 border-b border-gray-100 dark:border-gray-700/60 bg-gradient-to-br from-gray-50/50 to-transparent dark:from-gray-800/30">
          <div class="flex items-center space-x-3">
            <div class="flex items-center justify-center w-11 h-11 rounded-xl bg-gradient-to-br from-emerald-500 to-teal-600 shadow-lg shadow-emerald-500/30">
              <svg class="w-6 h-6 text-white dark:text-gray-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
              </svg>
            </div>
            <div>
              <h2 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight">
                Aktiv foydalanuvchilar
              </h2>
              <p class="text-sm text-gray-600 dark:text-gray-300 font-medium mt-0.5">
                Activity over the last 7 days
              </p>
            </div>
          </div>
        </div>
        <div class="p-8 bg-white dark:!bg-gray-900">
          <canvas id="userActivityChart" height="200"></canvas>
        </div>
      </div>

    </div>

    <!-- Top Movies Chart -->
    <div class="group relative overflow-hidden rounded-2xl bg-white dark:!bg-gray-900 backdrop-blur-sm border border-gray-200 dark:border-gray-700/80 shadow-lg hover:shadow-2xl dark:shadow-gray-900/30 dark:hover:shadow-gray-900/50 transition-all duration-300">
      <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-amber-500 via-orange-500 to-amber-500 opacity-75 dark:opacity-90"></div>
      <div class="p-6 border-b border-gray-100 dark:border-gray-700/60 bg-gradient-to-br from-gray-50/50 to-transparent dark:from-gray-800/30">
        <div class="flex items-center space-x-3">
          <div class="flex items-center justify-center w-11 h-11 rounded-xl bg-gradient-to-br from-amber-500 to-orange-600 shadow-lg shadow-amber-500/30">
            <svg class="w-6 h-6 text-white dark:text-gray-100" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z" />
            </svg>
          </div>
          <div>
            <h2 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight">
              Top 5 kinolar
            </h2>
            <p class="text-sm text-gray-600 dark:text-gray-300 font-medium mt-0.5">
              Highest rated movies by users
            </p>
          </div>
        </div>
      </div>
      <div class="p-8 bg-white dark:!bg-gray-900">
        <canvas id="topMoviesChart" height="110"></canvas>
      </div>
    </div>

  </div>

</div>

<!-- JSON data -->
{{ top_movies|json_script:"top_movies_data" }}
{{ user_activity|json_script:"user_activity_data" }}

<!-- Chart.js -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const topMovies = JSON.parse(document.getElementById('top_movies_data').textContent);
  const labels = topMovies.map(m => m.title);
  const ratings = topMovies.map(m => m.avg_rating);

  const ctx = document.getElementById('topMoviesChart').getContext('2d');
  const usersCtx = document.getElementById('usersPieChart').getContext('2d');
  const activityCtx = document.getElementById('userActivityChart').getContext('2d');

  function getChartColors() {
    const isDark = document.documentElement.classList.contains("dark");
    return {
      text: isDark ? "#f9fafb" : "#111827",
      grid: isDark ? "#374151" : "#e5e7eb",
      gridLight: isDark ? "#1f2937" : "#f3f4f6",
      barColor: isDark ? "rgba(245, 158, 11, 0.9)" : "rgba(245, 158, 11, 0.85)",
      barBorder: isDark ? "rgba(245, 158, 11, 1)" : "rgba(245, 158, 11, 1)",
      pieColor1: isDark ? "rgba(139, 92, 246, 0.9)" : "rgba(139, 92, 246, 0.85)",
      pieColor2: isDark ? "rgba(59, 130, 246, 0.9)" : "rgba(59, 130, 246, 0.85)",
      lineColor: isDark ? "rgba(16, 185, 129, 1)" : "rgba(16, 185, 129, 1)",
      lineBg: isDark ? "rgba(16, 185, 129, 0.2)" : "rgba(16, 185, 129, 0.12)",
    };
  }

  let chartColors = getChartColors();

  // Initialize charts
  let chart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [{
        label: "O'rtacha reyting",
        data: ratings,
        backgroundColor: chartColors.barColor,
        borderColor: chartColors.barBorder,
        borderWidth: 0,
        borderRadius: 10,
        borderSkipped: false,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: true,
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(17, 24, 39, 0.95)',
          titleColor: chartColors.text,
          bodyColor: chartColors.text,
        }
      },
      scales: {
        x: { ticks: { color: chartColors.text } },
        y: { ticks: { color: chartColors.text }, grid: { color: chartColors.gridLight } }
      }
    }
  });

  let usersPie = new Chart(usersCtx, {
    type: 'doughnut',
    data: {
      labels: ["Premium", "Regular"],
      datasets: [{
        data: [{{ stats.premium_users }}, {{ stats.total_users|default:0 }} - {{ stats.premium_users|default:0 }}],
        backgroundColor: [chartColors.pieColor1, chartColors.pieColor2],
        borderWidth: 0,
      }]
    },
    options: {
      plugins: {
        legend: { labels: { color: chartColors.text } },
        tooltip: {
          backgroundColor: 'rgba(17, 24, 39, 0.95)',
          titleColor: chartColors.text,
          bodyColor: chartColors.text,
        }
      }
    }
  });

  const activityData = JSON.parse(document.getElementById('user_activity_data').textContent);
  let userActivityChart = new Chart(activityCtx, {
    type: 'line',
    data: {
      labels: activityData.labels,
      datasets: [{
        data: activityData.data,
        borderColor: chartColors.lineColor,
        backgroundColor: chartColors.lineBg,
        pointBackgroundColor: chartColors.lineColor,
      }]
    },
    options: {
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: 'rgba(17, 24, 39, 0.95)',
          titleColor: chartColors.text,
          bodyColor: chartColors.text,
        }
      },
      scales: {
        x: { ticks: { color: chartColors.text } },
        y: { ticks: { color: chartColors.text } }
      }
    }
  });

  const observer = new MutationObserver(() => {
    chartColors = getChartColors();

    // Destroy and recreate charts for full dark mode adaptation
    chart.destroy();
    usersPie.destroy();
    userActivityChart.destroy();

    chart = new Chart(ctx, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          data: ratings,
          backgroundColor: chartColors.barColor,
          borderColor: chartColors.barBorder,
        }]
      },
      options: {
        plugins: {
          tooltip: {
            backgroundColor: 'rgba(17, 24, 39, 0.95)',
            titleColor: chartColors.text,
            bodyColor: chartColors.text,
          }
        },
        scales: {
          x: { ticks: { color: chartColors.text } },
          y: { ticks: { color: chartColors.text }, grid: { color: chartColors.gridLight } }
        }
      }
    });

    usersPie = new Chart(usersCtx, {
      type: 'doughnut',
      data: {
        labels: ["Premium", "Regular"],
        datasets: [{
          data: [{{ stats.premium_users }}, {{ stats.total_users|default:0 }} - {{ stats.premium_users|default:0 }}],
          backgroundColor: [chartColors.pieColor1, chartColors.pieColor2],
        }]
      },
      options: {
        plugins: {
          legend: { labels: { color: chartColors.text } },
          tooltip: {
            backgroundColor: 'rgba(17, 24, 39, 0.95)',
            titleColor: chartColors.text,
            bodyColor: chartColors.text,
          }
        }
      }
    });

    userActivityChart = new Chart(activityCtx, {
      type: 'line',
      data: {
        labels: activityData.labels,
        datasets: [{
          data: activityData.data,
          borderColor: chartColors.lineColor,
          backgroundColor: chartColors.lineBg,
          pointBackgroundColor: chartColors.lineColor,
        }]
      },
      options: {
        plugins: {
          tooltip: {
            backgroundColor: 'rgba(17, 24, 39, 0.95)',
            titleColor: chartColors.text,
            bodyColor: chartColors.text,
          }
        },
        scales: {
          x: { ticks: { color: chartColors.text } },
          y: { ticks: { color: chartColors.text } }
        }
      }
    });
  });

  observer.observe(document.documentElement, { attributes: true, attributeFilter: ['class'] });
</script>
{% endblock %}